<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vite + Vue + TS</title>
</head>

<body>
  <div id="app"></div>
  <script>
    const handleGoogleLogin = async () => {
      const url = new URL(window.location.href);
      const code = url.searchParams.get('code');
      if (code) {
        url.searchParams.delete('code');
        url.searchParams.delete('redirect_uri');
        url.searchParams.delete('scope');
        url.searchParams.delete('authuser');
        url.searchParams.delete('prompt');
        window.history.replaceState('', '', url);
        const targetUrl = new URL('https://x8ki-letl-twmt.n7.xano.io/api:-JtYy9Ru/oauth/google/continue');
        targetUrl.searchParams.set('code', code);
        targetUrl.searchParams.set('redirect_uri', window.location.origin + '/login.html');
        fetch(targetUrl)
          .then(response => response.json())
          .then(json => {
            if (json.token) {
              localStorage.setItem('token', json.token);
              window.location.href = window.location.origin;
            }
          });
      }
    };

    handleGoogleLogin();
  </script>
</body>

</html>
